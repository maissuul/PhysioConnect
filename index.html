<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PhysioConnect โ ุตูุญุฉ ุชุฑุญูุจูุฉ + ูุฑูุถ + ุฃุฎุตุงุฆู</title>
  <style>
    :root{
      --bg:#f6f9fb;--card:#fff;--text:#0f172a;--muted:#64748b;--border:#e5e7eb;
      --sky:#0ea5e9;--sky-600:#0284c7;--emerald:#10b981;--rose:#ef4444;--amber:#f59e0b;
      --radius:18px;--shadow:0 10px 22px rgba(2,132,199,.07)
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:"Tajawal",system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      background:var(--bg);
      color:var(--text)
    }
    a{color:var(--sky-600);text-decoration:none}
    header{
      position:sticky;top:0;z-index:40;
      background:#fff;border-bottom:1px solid var(--border)
    }
    .container{max-width:1180px;margin:auto;padding:0 16px}
    .row{display:grid;gap:16px}
    @media(min-width:860px){
      .row-2{grid-template-columns:1.5fr 2fr}
      .row-3{grid-template-columns:1fr 1fr 1fr}
    }
    .card{
      background:var(--card);
      border:1px solid var(--border);
      border-radius:var(--radius);
      box-shadow:var(--shadow)
    }
    .p-4{padding:16px}.p-5{padding:20px}.px-4{padding-left:16px;padding-right:16px}
    .py-3{padding-top:12px;padding-bottom:12px}
    .btn{
      padding:10px 14px;border-radius:12px;
      border:1px solid var(--border);
      background:#fff;cursor:pointer;font:inherit
    }
    .btn:hover{background:#f8fafc}
    .btn-primary{background:var(--sky);border-color:var(--sky);color:#fff}
    .btn-primary:hover{background:var(--sky-600)}
    .btn-emerald{background:var(--emerald);border-color:var(--emerald);color:#fff}
    .btn-rose{border-color:#fecaca}
    .badge{
      display:inline-block;padding:4px 8px;border:1px solid #e2e8f0;
      border-radius:999px;background:#f8fafc;color:#334155;font-size:12px
    }
    .muted{color:var(--muted)}
    .hidden{display:none}
    input,select,textarea{
      border:1px solid var(--border);border-radius:12px;
      padding:10px;width:100%;font:inherit;background:#fff
    }
    textarea{resize:vertical}
    .section > .head{
      display:flex;align-items:center;justify-content:space-between;margin-bottom:12px
    }
    .section > .head h3{margin:0;font-size:16px}
    .progress{
      height:10px;border-radius:999px;
      background:#e5e7eb;overflow:hidden
    }
    .progress > div{height:100%;background:var(--emerald)}
    .nav-btn{
      margin-inline:4px;padding:10px 12px;border-radius:12px;
      border:1px solid var(--border);background:#fff;cursor:pointer
    }
    .nav-btn.active{background:var(--sky-600);border-color:var(--sky-600);color:#fff}
    .modal{
      position:fixed;inset:0;background:rgba(0,0,0,.35);
      backdrop-filter:blur(2px);display:grid;place-items:center;
      padding:16px;z-index:60
    }
    .modal.hidden{display:none !important}
    .modal-card{
      background:#fff;border:1px solid var(--border);
      border-radius:16px;max-width:760px;width:100%
    }
    .list{display:grid;gap:12px}
    .flex{display:flex}.items-center{align-items:center}
    .justify-between{justify-content:space-between}.gap-2{gap:8px}.gap-3{gap:12px}
    .text-xs{font-size:12px}.text-sm{font-size:14px}
    .text-lg{font-size:18px}.text-xl{font-size:22px}.fw-700{font-weight:700}
    .line-through{text-decoration:line-through}
    .center{text-align:center}
    footer{border-top:1px solid var(--border);background:#fff}
  </style>
</head>
<body>
  <!-- ุงูููุฏุฑ ุจุนุฏ ุชุณุฌูู ุงูุฏุฎูู (ูุฑูุถ/ุฃุฎุตุงุฆู) -->
  <header id="navbar" class="hidden">
    <div class="container py-3 flex items-center justify-between">
      <div class="flex items-center gap-2">
        <div style="width:36px;height:36px;border-radius:12px;background:var(--sky);display:grid;place-items:center;color:#fff">โ๏ธ</div>
        <div>
          <div class="fw-700">PhysioConnect</div>
          <div class="text-xs muted">ููุตุฉ ุงูุนูุงุฌ ุงูุทุจูุนู ุนู ุจูุนุฏ</div>
        </div>
      </div>
      <nav>
        <button class="nav-btn" data-route="home" data-role="patient">ุงูุฑุฆูุณูุฉ (ุงููุฑูุถ)</button>
        <button class="nav-btn" data-route="find" data-role="patient">ุงุจุญุซ ุนู ุฃุฎุตุงุฆู</button>
        <button class="nav-btn" data-route="dashboard" data-role="patient">ูููู ุงูุนูุงุฌู</button>
        <button class="nav-btn" data-route="specialist" data-role="specialist">ุตูุญุฉ ุงูุฃุฎุตุงุฆู</button>
        <button id="logoutBtn" class="nav-btn" style="margin-inline-start:8px">ุฎุฑูุฌ</button>
      </nav>
    </div>
  </header>

  <!-- ููุฏุฑ ุตูุญุฉ ุงูุชุฑุญูุจ: ุฒุฑ ุชุณุฌูู ุงูุฏุฎูู ุฃุนูู ุงูุตูุญุฉ -->
  <header id="landing-header">
    <div class="container py-3 flex items-center justify-between">
      <div class="fw-700 text-lg">PhysioConnect</div>
      <button id="landing-login-top" class="btn btn-primary">
        ุชุณุฌูู ุงูุฏุฎูู
      </button>
    </div>
  </header>

  <!-- ุตูุญุฉ ุฑุฆูุณูุฉ ูุจู ุชุณุฌูู ุงูุฏุฎูู (Landing) -->
  <main id="page-landing">
    <!-- ุงูููุฑู + ููุงุฐุง ููุฒููููููุช -->
    <section class="container" style="padding:18px 16px 20px">
      <div class="row row-2" style="align-items:center">
        <div>
          <div class="badge" style="margin-bottom:10px">ูุณุฎุฉ ุชุฌุฑูุจูุฉ ููุนุฑุถ ุงูุฃูุงุฏููู</div>
          <h1 class="text-xl fw-700" style="margin:0 0 8px">
            PhysioConnect
            <span style="color:var(--sky)">ููุตุฉ ุงูุนูุงุฌ ุงูุทุจูุนู ุนู ุจูุนุฏ</span>
          </h1>
          <p class="text-sm muted" style="margin:0 0 14px">
            ุชุฑุจุท ุงููุฑุถู ุจุฃุฎุตุงุฆูู ุงูุนูุงุฌ ุงูุทุจูุนู ุจุนุฏ ุชูููู ุญุถูุฑู ุฃูููุ ุซู ูุชุงุจุนุฉ ุฑูููุฉ ุชุดูู ุฎุทุฉ ุชูุงุฑููุ
            ุชูููู ุงูุฃูู ูุงูุฌูุฏุ ููุชุงุจุนุฉ ุชูุฏู ุงูุญุงูุฉ ุนุจุฑ ุฑุณูู ุจูุงููุฉ ูุชูุงุฑูุฑ ูุจุณูุทุฉ.
          </p>
          <div class="flex gap-2" style="margin-bottom:10px;flex-wrap:wrap">
            <button id="landing-scroll" class="btn">ุงุณุชูุดู ูุฒุงูุง ุงูููุตุฉ</button>
          </div>
          <div class="text-xs muted">
            * ูุฐู ุงููุณุฎุฉ ูุง ุชุญูุธ ุจูุงูุงุช ุญููููุฉุ ุฅููุง ุชุณุชุฎุฏู
            <b>LocalStorage</b> ููููุฐุฌ ุฃููู ููุนุฑุถ ููุท.
          </div>
        </div>
        <div class="card p-4">
          <div class="fw-700" style="margin-bottom:6px">ููุงุฐุง PhysioConnectุ</div>
          <ul class="text-sm" style="margin:0;padding-right:20px">
            <li><b>ูุทุงุจูุฉ ุฐููุฉ:</b> ุญุณุจ ุงูุฃุนุฑุงุถุ ุงูุชุฎุตุต ุงูุฏูููุ ูุงููููุน.</li>
            <li><b>ูุชุงุจุนุฉ ุนู ุจูุนุฏ:</b> ุฌูุณุงุช ูุฑุฆูุฉ ุขููุฉ ูุฎุทุฉ ุชูุงุฑูู ููุฒููุฉ.</li>
            <li><b>ุชูููู ุงูุชูุฏู:</b> ุฃุฏูุงุช ููุชุงุจุนุฉ ุดุฏุฉ ุงูุฃูู ููุณุชูู ุงูุฌูุฏ (RPE).</li>
          </ul>
        </div>
      </div>
    </section>

    <section id="landing-features" class="container row row-3" style="padding:0 16px 28px">
      <div class="card p-4 section" style="background:#f0fdf4">
        <div class="head"><h3>ุฎุทุฉ ุนูุงุฌูุฉ ูุฎุตุตุฉ ๐ข</h3></div>
        <div class="text-sm">
          ุงูุฃุฎุตุงุฆู ูุญุฏุฏ ูู ุชูุงุฑูู ููุฒููุฉ ุฏูููุฉุ ูุชุณุชุทูุน ุชุณุฌูู ูุฏู ุงูุฃูู ูุงูุฌูุฏ ูู ูู ุชูุฑูู.
        </div>
      </div>
      <div class="card p-4 section" style="background:#fff1f2">
        <div class="head"><h3>ูุง ุชูุชุธุฑ! ๐ด</h3></div>
        <div class="text-sm">
          ุงูุจุฏุก ุงููุจูุฑ ุจุงูุนูุงุฌ ุงูุทุจูุนู ูููู ูุฏุฉ ุงูุชุนุงูู ููููุน ุชุญููู ุงูุฃูู ุฅูู ุญุงูุฉ ูุฒููุฉ. ูุธุงููุง ูุณููู ุนููู ุงูุฎุทูุฉ ุงูุฃููู.
        </div>
      </div>
      <div class="card p-4 section" style="background:#eff6ff">
        <div class="head"><h3>ุฃูุงู ูุฎุตูุตูุฉ ๐น</h3></div>
        <div class="text-sm">
          ููุชุฒู ุจุงููุนุงููุฑ ุงูุนุงูููุฉ ูุญูุงูุฉ ุจูุงูุงุชู ุงูุตุญูุฉ ูุฌูุณุงุชูุ ูุชุทูุฆู ุนูู ุฎุตูุตูุชู ุจุงููุงูู.
        </div>
      </div>
    </section>
  </main>

  <!-- Login -->
  <main id="page-login" class="container hidden" style="padding:28px 16px 24px">
    <div class="card p-5 section">
      <div style="margin-bottom:8px">
        <button id="login-back" class="btn">โฌ๏ธ ุงูุนูุฏุฉ ููุตูุญุฉ ุงูุฑุฆูุณูุฉ</button>
      </div>
      <div class="head"><h3>ุชุณุฌูู ุงูุฏุฎูู</h3></div>
      <div class="row" style="gap:14px">
        <div>
          <div class="text-sm muted" style="margin-bottom:6px">ุงุฎุชุฑ ููุน ุงูุญุณุงุจ</div>
          <div class="row" style="grid-template-columns:1fr 1fr;gap:10px">
            <button id="role-patient" class="btn">ูุฑูุถ</button>
            <button id="role-specialist" class="btn">ุฃุฎุตุงุฆู</button>
          </div>
        </div>
        <label class="text-sm">ุงูุจุฑูุฏ ุงูุฅููุชุฑููู
          <input id="login-email" placeholder="you@example.com" />
        </label>
        <label class="text-sm">ูููุฉ ุงููุฑูุฑ
          <input id="login-pass" type="password" placeholder="โขโขโขโข" />
        </label>
        <button id="login-submit" class="btn btn-primary">ุฏุฎูู</button>
        <div class="text-xs muted">ูุณุฎุฉ ุชุฌุฑูุจูุฉ: ุฃู ุจุฑูุฏ ุตุงูุญ + ูููุฉ ูุฑูุฑ (ูค+ ุฃุญุฑู) ุชุนูู.</div>
      </div>
    </div>
  </main>

  <!-- Home (ูุฑูุถ) - ูุฎุชููุฉ ุนู ุตูุญุฉ ุงูุชุฑุญูุจ -->
  <main id="page-home" class="hidden">
    <!-- ุตู ุนููู: ููุฎุต + ุจุญุซ ุณุฑูุน -->
    <section class="container" style="padding:24px 16px 8px">
      <div class="row row-2" style="align-items:start">
        <!-- ููุฎุต ุญุงูุฉ ุงููุฑูุถ -->
        <div class="card p-5 section">
          <div class="head">
            <h3>ููุฎุต ุญุงูุชู ุงูููู</h3>
          </div>
          <div class="text-sm muted">
            ูุธุฑุฉ ุณุฑูุนุฉ ุนูู ุชูุฏููู ูู ุฎุทุฉ ุงูุชูุงุฑูู ูุฃูุฑุจ ุฌูุณุฉ ุนูุงุฌูุฉ.
          </div>

          <!-- ุงูุชูุฏูู -->
          <div style="margin-top:14px">
            <div class="text-sm muted">
              ุชูุฏููู ูู ุงูุชูุงุฑูู: <b id="home-progressPct">0%</b>
            </div>
            <div class="progress" style="margin-top:6px">
              <div id="home-progressBar" style="width:0%"></div>
            </div>
          </div>

          <!-- ุงูุฌูุณุฉ ุงููุงุฏูุฉ -->
          <div style="margin-top:16px">
            <div class="fw-700 text-sm" style="margin-bottom:6px">ุฌูุณุชู ุงููุงุฏูุฉ</div>
            <div id="home-next-appt" class="text-sm muted">
              ูุง ุชูุฌุฏ ููุงุนูุฏ ููุฑูุฑุฉ ุญุงูููุง. ููููู ุญุฌุฒ ููุนุฏ ุฌุฏูุฏ ูู ุงูุฃุฒุฑุงุฑ ุจุงูุฃุณูู.
            </div>
          </div>

          <!-- ุฃุฒุฑุงุฑ ุณุฑูุนุฉ -->
          <div class="flex gap-2" style="margin-top:16px;flex-wrap:wrap">
            <button class="btn btn-primary" id="home-go-dashboard">ุงูุฐูุงุจ ููููู ุงูุนูุงุฌู</button>
            <button class="btn" id="home-go-find">ุญุฌุฒ ููุนุฏ ุฌุฏูุฏ / ุงูุนุซูุฑ ุนูู ุฃุฎุตุงุฆู</button>
          </div>
        </div>

        <!-- ูุต ุชุฑุญูุจู + ุจุญุซ ุณุฑูุน ุนู ุฃุฎุตุงุฆู -->
        <div>
          <h1 class="text-xl fw-700" style="margin:0 0 10px">
            ูุฑุญุจูุง ุจู ูู ูููู ุงูุนูุงุฌู ุนูู PhysioConnect
          </h1>
          <p class="text-sm muted" style="margin:0 0 14px">
            ูู ููุง ููููู ูุชุงุจุนุฉ ุฎุทุชู ุงูุญุงููุฉุ ููุชู ุงุญุชุฌุช ุฑุฃููุง ุฅุถุงูููุง ููููู ุงูุจุญุซ ุนู ุฃุฎุตุงุฆู ุฌุฏูุฏ ููุงุณุจ ุชุทููุฑ ุญุงูุชู.
          </p>

          <div class="card p-4 section">
            <div class="head">
              <h3>ุจุญุซ ุณุฑูุน ุนู ุฃุฎุตุงุฆู</h3>
            </div>
            <div class="flex gap-2">
              <button id="home-search" class="btn btn-primary" style="width:110px">ุงุจุญุซ</button>
              <div style="flex:1">
                <input id="home-query" placeholder="ูุซุงู: ุฃูู ุงูุฑูุจุฉ ุจุนุฏ ุงูุฌููุณ ุงูุทููู" />
              </div>
            </div>
            <div class="text-xs muted" style="margin-top:6px">
              ุณูุชู ูููู ุฅูู ุตูุญุฉ ุงูุจุญุซ ูุน ุนุฑุถ ุงูุฃุฎุตุงุฆููู ุงููุทุงุจููู ูููููุงุช ุงูุชู ุชูุชุจูุง ููุง.
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- ูุฑูุช ุชูุนููุฉ -->
    <section class="container row row-3" style="padding:8px 16px 28px">
      <div class="card p-4 section" style="background:#f0fdf4">
        <div class="head"><h3>ุฎุทุฉ ุชูุงุฑููู</h3></div>
        <div class="text-sm">
          ุฑุงุฌุน ูุงุฆูุฉ ุงูุชูุงุฑูู ูู ุตูุญุฉ "ูููู ุงูุนูุงุฌู"ุ ูุนูููู ุนูู ูู ุชูุฑูู ุชู ุฅูุฌุงุฒู ูุชุญุณูู ุฏููุฉ ูุชุงุจุนุฉ ุงูุชูุฏูู.
        </div>
      </div>
      <div class="card p-4 section" style="background:#fff1f2">
        <div class="head"><h3>ุชุฐููุฑ ููู</h3></div>
        <div class="text-sm">
          ุฅุฐุง ุฒุงุฏ ุงูุฃูู ุฃู ุธูุฑ ุนุฑุถ ุฌุฏูุฏุ ุญุฏูุซ ููุงุญุธุงุชู ูู ููุญุฉ ุงููุฑูุถุ ูุฃุจูุบ ุฃุฎุตุงุฆูู ูู ุงูุฌูุณุฉ ุงููุงุฏูุฉ.
        </div>
      </div>
      <div class="card p-4 section" style="background:#eff6ff">
        <div class="head"><h3>ูุตูุญุฉ ุงูููู</h3></div>
        <div class="text-sm">
          ุญุงูู ุชูุณูู ููุช ุงูุฌููุณ ุงูุทููู ุฅูู ูุชุฑุงุช ูุตูุฑุฉุ ูุน ุงููุดู ุฃู ุชูุงุฑูู ุฅุทุงูุฉ ุจุณูุทุฉ ูู 30โ45 ุฏูููุฉ.
        </div>
      </div>
    </section>
  </main>

  <!-- Find -->
  <main id="page-find" class="hidden">
    <section class="container section" style="padding:20px 16px 24px">
      <div class="card p-5 section">
        <div class="head"><h3>ุงุจุญุซ ุนู ุฃุฎุตุงุฆู</h3><div class="text-sm muted">ุฃุฏุฎู ุฃุนุฑูุงุถู ูููุชุฑุญ ุงููุธุงู ุงูุฃูุณุจ</div></div>
        <div class="flex gap-2" style="margin-bottom:10px">
          <input id="find-query" placeholder="ูุซุงู: ุฃูู ุฃุณูู ุงูุธูุฑ ุนูุฏ ุงูุงูุญูุงุก" />
          <button id="find-search" class="btn btn-primary">ุจุญุซ</button>
        </div>
        <div id="find-hint" class="text-xs muted" style="margin-bottom:10px"></div>
        <div id="find-list" class="list"></div>
      </div>
    </section>
  </main>

  <!-- Dashboard (Patient) -->
  <main id="page-dashboard" class="hidden">
    <section class="container row row-3" style="padding:20px 16px 24px;align-items:start">
      <div class="row" style="gap:16px">
        <div class="card p-4 section">
          <div class="head"><h3>ููุงุนูุฏู</h3></div>
          <div id="appt-list" class="list"></div>
        </div>
        <div class="card p-4 section">
          <div class="head"><h3>ููุงุญุธุงุช ุณุฑูุนุฉ</h3></div>
          <textarea rows="4" placeholder="ุงูุชุจ ุฃู ููุงุญุธุฉ ููุทุจูุจ ูู ุฌูุณุชู ุงููุงุฏูุฉ (ุชุญูุธ ูุญููุงู ููุท)โฆ" id="quick-note"></textarea>
        </div>
      </div>
      <div>
        <div class="card p-4 section">
          <div class="head"><h3>ุฎุทุฉ ุงูุชูุงุฑูู</h3><div class="text-sm muted">ุชูุฏููู: <span id="progressPct">0%</span></div></div>
          <div class="progress" style="margin-bottom:10px"><div id="progressBar" style="width:0%"></div></div>
          <div id="ex-list" class="list"></div>
          <div class="card p-4 section" style="margin-top:12px">
            <div class="head"><h3>ุฅุฑุดุงุฏุงุช</h3></div>
            <ul class="text-sm" style="margin:0;padding-right:20px">
              <li>ุญุงูุธ ุนูู ุงุณุชูุงูุฉ ุงูุธูุฑ ุนูุฏ ุงูุฌููุณ ุงูุทูููุ ููู ูุชุญุฑูู ูู 30โ45 ุฏูููุฉ.</li>
              <li>ูุฒูุน ุงูุชูุงุฑูู ุนูู ุงูููู ุจุฏู ุชุฌููุนูุง ุฏูุนุฉ ูุงุญุฏุฉ.</li>
              <li>ุฃููู ุงูุชูุฑูู ุนูุฏ ุธููุฑ ุฃูู ุญุงุฏ ุฃู ุฏูุงุฑ ุบูุฑ ูุนุชุงุฏ.</li>
            </ul>
          </div>
        </div>

        <!-- ุงููุณุงุนุฏ ุงูุฐูู ูููุฑูุถ -->
        <div class="card p-4 section" style="margin-top:12px">
          <div class="head">
            <h3>ุงููุณุงุนุฏ ุงูุฐูู (ุชุฌุฑูุจู ูููุฑูุถ)</h3>
            <div class="text-sm muted">ูุณุงุนุฏู ุนูู ููู ุชูุงุฑููู ูุฃููู ุจุดูู ูุจุณูุท.</div>
          </div>
          <label class="text-sm">ุงูุชุจ ุณุคุงูู ุฃู ูุตู ุญุงูุชู
            <textarea id="pt-ai-input" rows="3" placeholder="ูุซุงู: ุฃุญุณ ุจุฃูู ูู ุงูุฑูุจุฉ ุจุนุฏ ุตุนูุฏ ุงูุฏุฑุฌ..."></textarea>
          </label>
          <div class="flex gap-2" style="margin-top:8px">
            <button id="pt-ai-run" class="btn btn-primary">ุชุญููู ูุจุฏุฆู</button>
            <span class="text-xs muted">ุงูุฑุฏ ููุชุซููู ุงูุตุญู ููุท ููุง ูุบูู ุนู ุงุณุชุดุงุฑุฉ ุงูุฃุฎุตุงุฆู.</span>
          </div>
          <div id="pt-ai-output" class="text-sm" style="margin-top:10px"></div>
        </div>
      </div>
    </section>
  </main>

  <!-- Specialist Page -->
  <main id="page-specialist" class="hidden">
    <!-- ุชุจููุจุงุช ุตูุญุฉ ุงูุฃุฎุตุงุฆู -->
    <section class="container" style="padding:16px 16px 0">
      <div class="card p-4">
        <div class="flex gap-2">
          <button class="btn sp-tab-btn btn-primary" data-tab="sp-tab-main">ุฎุทุฉ ุงููุฑุถู</button>
          <button class="btn sp-tab-btn" data-tab="sp-tab-appts">ููุงุนูุฏ ุงููุฑุถู</button>
          <button class="btn sp-tab-btn" data-tab="sp-tab-ai">ุงููุณุงุนุฏ ุงูุฐูู</button>
        </div>
      </div>
    </section>

    <!-- ุชุจููุจ: ุฅุฏุงุฑุฉ ุงููุฑุถู + ุฎุทุฉ ุงูุชูุงุฑูู + ุงูุฑุณู ุงูุจูุงูู -->
    <section id="sp-tab-main" class="container row row-2" style="padding:20px 16px 24px;align-items:start">
      <!-- ุงูุนููุฏ ุงูุฃูุณุฑ: ุฎุทุฉ ุงูุชูุงุฑูู ููุท -->
      <div class="row" style="gap:16px;align-self:start">
        <!-- ุชุตููู ุงูุชูุงุฑูู ูููุฑูุถ ุงููุญุฏุฏ -->
        <div class="card p-4 section">
          <div class="head">
            <h3>ุชุตููู ุงูุชูุงุฑูู ูููุฑูุถ ุงููุญุฏุฏ</h3>
            <div class="text-sm muted">ุงููุฑูุถ ุงูุญุงูู: <b id="sp-current-name">โ</b></div>
          </div>
          <div class="row row-2">
            <label class="text-sm">ุงุณู ุงูุชูุฑูู
              <input id="ex-name" placeholder="ูุซุงู: Bridging โ ุฑูุน ุงูุญูุถ" />
            </label>
            <label class="text-sm">ุงูุชูุฑุงุฑุงุช (Reps)
              <input id="ex-reps" type="number" min="1" value="12" />
            </label>
            <label class="text-sm">ุงูุฌููุงุช (Sets)
              <input id="ex-sets" type="number" min="1" value="3" />
            </label>
            <label class="text-sm">ุงูุญุจุณ/ุงูุซูุงูู (ุงุฎุชูุงุฑู)
              <input id="ex-hold" type="number" min="0" value="0" />
            </label>
            <label class="text-sm">ุงูููุฏูู ุงูุชูุถูุญู (ุงุฎุชูุงุฑู)
              <input id="ex-video" placeholder="https://.../demo.mp4" />
            </label>
            <label class="text-sm">ุฅุฑุดุงุฏุงุช
              <input id="ex-notes" placeholder="ุดุฏู ุงูุจุทู ูุจู ุงูุฑูุนุ ุงูุชููุณโฆ" />
            </label>
          </div>
          <div class="flex gap-2" style="margin-top:8px">
            <button id="sp-add-ex" class="btn btn-emerald">ุฅุถุงูุฉ ุงูุชูุฑูู ููุฎุทุฉ</button>
            <button id="sp-new-plan" class="btn">ุฎุทุฉ ุฌุฏูุฏุฉ</button>
          </div>
          <div style="margin-top:10px">
            <div class="fw-700" style="margin-bottom:6px">ุฎุทุฉ ุงููุฑูุถ</div>
            <div id="sp-plan" class="list"></div>
          </div>
        </div>
      </div>

      <!-- ุงูุนููุฏ ุงูุฃููู: ูุงุฆูุฉ ุงููุฑุถู + ุชุญุชูุง ุงูุฑุณู ุงูุจูุงูู -->
      <div class="row" style="gap:16px;align-self:start">
        <!-- ูุงุฆูุฉ ุงููุฑุถู -->
        <div class="card p-4 section">
          <div class="head"><h3>ูุงุฆูุฉ ุงููุฑุถู</h3></div>
          <div id="sp-patients" class="list"></div>
          <div class="row" style="grid-template-columns:2fr 1fr;gap:8px;margin-top:8px">
            <input id="sp-new-name" placeholder="ุงุณู ุงููุฑูุถ" />
            <button id="sp-add" class="btn btn-primary">ุฅุถุงูุฉ</button>
          </div>
        </div>

        <!-- ุญุงูุฉ ุงููุฑูุถ โ ุงูุฑุณู ุงูุจูุงูู -->
        <div class="card p-4 section">
          <div class="head">
            <h3>ุญุงูุฉ ุงููุฑูุถ โ ุงูุฑุณู ุงูุจูุงูู</h3>
            <button id="sp-add-reading" class="btn btn-primary">ุฅุถุงูุฉ ูุฑุงุกุฉ</button>
          </div>
          <svg id="sp-chart" viewBox="0 0 560 220" style="width:100%;height:220px"></svg>
          <div class="text-xs muted">ูุนุฑุถ ุงูุฃูู ู RPE ูุขุฎุฑ 14 ููููุง ูููุฑูุถ ุงููุญุฏุฏ.</div>
        </div>
      </div>
    </section>

    <!-- ุชุจููุจ: ููุงุนูุฏ ุงููุฑุถู ูุฏู ุงูุฃุฎุตุงุฆู -->
    <section id="sp-tab-appts" class="container hidden" style="padding:20px 16px 28px">
      <div class="card p-4 section">
        <div class="head"><h3>ููุงุนูุฏ ุงููุฑุถู ูุฏู ุงูุฃุฎุตุงุฆู</h3><div class="text-sm muted">ุชุนุฑุถ ููุท ุงูููุงุนูุฏ ุงูุชู ุญุฌุฒุช ุจุงุณู ุงูุฃุฎุตุงุฆู ุงููุญุฏุฏ ูู ุงูุจูุงูุงุช.</div></div>
        <div class="row" style="grid-template-columns:1fr 1fr;gap:12px;margin-bottom:8px">
          <label class="text-sm">ุชุตููุฉ ูุตููุฉ (ุงุณู/ููุงุญุธุฉ)
            <input id="sp-appt-q" placeholder="ุงุจุญุซ ุฏุงุฎู ุงูููุงุนูุฏ" />
          </label>
          <div class="text-sm muted" style="display:flex;align-items:end">ููููู ุฅูุบุงุก ููุนุฏ ุฃู ูุดุงุฑูุฉ ุชูุงุตููู.</div>
        </div>
        <div id="sp-appointments" class="list"></div>
      </div>
    </section>

    <!-- ุชุจููุจ: ุงููุณุงุนุฏ ุงูุฐูู ููุฃุฎุตุงุฆู -->
    <section id="sp-tab-ai" class="container hidden" style="padding:20px 16px 28px">
      <div class="card p-4 section">
        <div class="head"><h3>ุงููุณุงุนุฏ ุงูุฐูู (ุชุฌุฑูุจู ููุฃุฎุตุงุฆู)</h3><div class="text-sm muted">ูุนุทู ููุชุฑุญุงุช ุฃูููุฉ ููุง ูุบูู ุนู ุงูุชูููู ุงูุณุฑูุฑู.</div></div>
        <label class="text-sm">ูุตู ูุฎุชุตุฑ ููุญุงูุฉ ุฃู ุงูุณุคุงู
          <textarea id="ai-input" rows="4" placeholder="ูุซุงู: ุฃูู ูุฒูู ุฃุณูู ุงูุธูุฑ ุนูุฏ ุงูุฌููุณ ุงูุทููู..."></textarea>
        </label>
        <div class="flex gap-2" style="margin-top:8px">
          <button id="ai-run" class="btn btn-primary">ุชุญููู ูุจุฏุฆู</button>
          <span class="text-xs muted">ุงููุชุงุฆุฌ ูุฃุบุฑุงุถ ุชุนููููุฉ ููุท ููุง ุชุนุชุจุฑ ุชุดุฎูุตูุง ุทุจููุง.</span>
        </div>
        <div id="ai-output" class="text-sm" style="margin-top:10px"></div>
      </div>
    </section>
  </main>

  <!-- Booking Modal -->
  <div id="booking" class="modal hidden" aria-hidden="true">
    <div class="modal-card p-5">
      <div class="flex items-center justify-between"><b id="bk-title">ุญุฌุฒ ููุนุฏ</b><button class="btn" data-close>ุฅุบูุงู</button></div>
      <div class="row row-2" style="margin-top:8px">
        <label class="text-sm">ุงูุชุงุฑูุฎ
          <input id="bk-date" type="date" />
        </label>
        <label class="text-sm">ุงูููุช
          <select id="bk-time"><option value="">ุงุฎุชุฑ ููุชูุง</option></select>
        </label>
        <label class="text-sm" style="grid-column:1/-1">ููุงุญุธุงุช ููุญุงูุฉ (ุงุฎุชูุงุฑู)
          <textarea id="bk-notes" rows="3" placeholder="ุฃูู ูุฒุฏุงุฏ ุนูุฏ ุตุนูุฏ ุงูุฏุฑุฌโฆ"></textarea>
        </label>
      </div>
      <div class="flex items-center justify-end gap-2" style="margin-top:10px">
        <button class="btn" data-close>ุฅูุบุงุก</button>
        <button id="bk-confirm" class="btn btn-primary" disabled>ุชุฃููุฏ ุงูุญุฌุฒ</button>
      </div>
    </div>
  </div>

  <!-- Share Modal -->
  <div id="share" class="modal hidden" aria-hidden="true">
    <div class="modal-card p-5">
      <div class="flex items-center justify-between"><b>ุญูุธ ููุดุงุฑูุฉ ุจูุงูุงุช ุงูุญุฌุฒ</b><button class="btn" data-close>ุฅุบูุงู</button></div>
      <div class="row row-2" style="margin-top:8px">
        <div>
          <div class="text-sm"><span class="muted">ุงูุฃุฎุตุงุฆู:</span> <b id="sh-sp">โ</b></div>
          <div class="text-sm"><span class="muted">ุงูุชุงุฑูุฎ:</span> <span id="sh-dt">โ</span></div>
          <div class="text-sm"><span class="muted">ุงูุฃุนุฑุงุถ:</span> <span id="sh-sym">โ</span></div>
          <div class="text-sm"><span class="muted">ููุงุญุธุงุช:</span> <span id="sh-notes">โ</span></div>
          <div class="text-sm"><span class="muted">ุฑูุฒ ุงูุฅุญุงูุฉ:</span> <code id="sh-id">โ</code></div>
          <div class="flex gap-2" style="margin-top:8px">
            <a id="sh-mail" class="btn btn-primary" href="#">ุฅุฑุณุงู ุนุจุฑ ุงูุจุฑูุฏ</a>
            <a id="sh-wa" class="btn" href="#" target="_blank" rel="noreferrer">ูุงุชุณุงุจ</a>
          </div>
        </div>
        <div>
          <label class="text-sm">ููู JSON ููุฅุญุงูุฉ:</label>
          <textarea id="sh-json" class="text-sm" style="width:100%;height:140px;margin-top:6px"></textarea>
          <div class="flex gap-2" style="margin-top:8px">
            <button id="sh-copy" class="btn">ูุณุฎ</button>
            <button id="sh-dl" class="btn">ุชูุฒูู JSON</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <footer class="py-3">
    <div class="container text-xs muted flex items-center justify-between">
      <div>ยฉ <span id="year"></span> PhysioConnect โ ูุณุฎุฉ ุฃูููุฉ ููุนุฑุถ</div>
      <div class="flex gap-3"><a href="#">ุงูุฎุตูุตูุฉ</a><a href="#">ุงูุดุฑูุท</a><span style="color:#cbd5e1">|</span><span>โค๏ธ ููุตุญุฉ ุงููุฌุชูุนูุฉ</span></div>
    </div>
  </footer>

  <script>
  // ===== Utilities =====
  const $ = (sel, root=document) => root.querySelector(sel);
  const $$ = (sel, root=document) => Array.from(root.querySelectorAll(sel));
  const saveLS = (k,v)=>localStorage.setItem(k,JSON.stringify(v));
  const readLS = (k,d)=>{try{const r=localStorage.getItem(k);return r?JSON.parse(r):d}catch{ return d }};
  const uid = ()=> Math.random().toString(36).slice(2)+Date.now().toString(36);
  const copyText = async (t)=>{try{await navigator.clipboard.writeText(t);return true}catch{return false}};
  const downloadJSON=(data,filename)=>{
    const blob=new Blob([JSON.stringify(data,null,2)],{type:'application/json'});
    const url=URL.createObjectURL(blob);
    const a=document.createElement('a');a.href=url;a.download=filename;a.click();
    URL.revokeObjectURL(url)
  };

  // ===== Data (demo) =====
  const SPECIALISTS=[
    {id:"sp1",name:"ุฏ. ุขููุฉ ุงูุญุฑุจู",title:"ุฃุฎุตุงุฆูุฉ ุนูุงุฌ ุทุจูุนู โ ุฅุตุงุจุงุช ุฑูุงุถูุฉ",rating:4.9,reviews:128,tags:["ุฑูุจุฉ","ูุชู","ุชูุงุฑูู ุชูููุฉ","ุฑูุงุถู"],location:"ุจุฑูุฏุฉ",remote:true,price:180,slots:["09:00","11:30","16:00","20:00"],email:"amina.physio@example.com",phone:"+966500000001"},
    {id:"sp2",name:"ุฃ. ูุญูุฏ ุงูุณุงูู",title:"ุฃุฎุตุงุฆู ุนูุงุฌ ุทุจูุนู โ ุขูุงู ุงูุธูุฑ ูุงูุฑูุจุฉ",rating:4.7,reviews:94,tags:["ุฑูุจุฉ","ุธูุฑ","ุงูุฒูุงู ุบุถุฑููู","ูุถุนูุฉ"],location:"ุจุฑูุฏุฉ",remote:true,price:150,slots:["10:00","13:30","18:00"],email:"moh.salem@example.com",phone:"+966500000002"},
    {id:"sp3",name:"ุฏ. ูููู ุงููุฑูู",title:"ุนูุงุฌ ุทุจูุนู โ ูุง ุจุนุฏ ุงูุนูููุงุช ูุงูุฌุฑูุญ",rating:4.8,reviews:66,tags:["ุชุฃููู","ุงุณุชุดูุงุก","ูุฑู","ุฑูุจุฉ"],location:"ุจุฑูุฏุฉ",remote:false,price:200,slots:["08:30","12:00","19:30"],email:"yumna.q@example.com",phone:"+966500000003"}
  ];
  const DEFAULT_EXERCISES=[
    {id:"ex-1",name:"ุฑูุน ุงูุฑูุจุฉ (3ร12)",desc:"ุชูููุฉ ุงูุนุถูุฉ ุงูุฑุจุงุนูุฉ ูุฑูุน ุงูุณูุทุฑุฉ ุนูู ููุตู ุงููุฑู ูุงูุฑูุจุฉ.",steps:["ุงุณุชููู ุนูู ุธูุฑูโฆ","ุดุฏู ุงูุจุทู ูุงุฑูุน ุงูุณุงูโฆ","ุงุซุจุช 2โ3 ุซูุงูู ุซู ุงูุฒูโฆ"],cautions:["ุชููู ุนูุฏ ุงูุฃูู ุงูุญุงุฏ","ุญุงูุธ ุนูู ุงูุธูุฑ ูุณุทุญูุง"],pain:null,effort:null,done:false},
    {id:"ex-2",name:"ุชูุฑูู ุงูุฌุณุฑ (3ร10)",desc:"ุชูููุฉ ุงูุฃุฑุฏุงู ูุฃุณูู ุงูุธูุฑ.",steps:["ุงุณุชููู ูุน ุซูู ุงูุฑูุจุชููโฆ","ุงุฑูุน ุงูุญูุถโฆ","ุงุซุจุช 3 ุซูุงููโฆ"],cautions:["ุชุฌููุจ ูุฑุท ููุณ ุงูุธูุฑ","ุชูููุณ ุทุจูุนููุง"],pain:null,effort:null,done:false},
    {id:"ex-3",name:"ุฅุทุงูุฉ ุฃูุชุงุฑ ุงูุฑูุจุฉ (ูุฑุชูู/ุงูููู)",desc:"ุฅุทุงูุฉ ุซุงุจุชุฉ ูุฒูุงุฏุฉ ุงููุฑููุฉ.",steps:["ุงุฌูุณ ูุงูุฏุฏ ุณุงููุงโฆ","ุงูุญูู ูู ุงููุฑูโฆ","ุงุซุจุช 20โ30 ุซุงููุฉโฆ"],cautions:["ูุง ุชูุทูุท ุฃุซูุงุก ุงูุฅุทุงูุฉ","ุฃููู ุนูุฏ ุฎุฏุฑ ุดุฏูุฏ"],pain:null,effort:null,done:false}
  ];
  const DEFAULT_PATIENTS=[{id:"p-1",name:"ูุญูุฏ ุนูู"},{id:"p-2",name:"ุณุงุฑุฉ ุญุณู"},{id:"p-3",name:"ุฎุงูุฏ ูุงุตุฑ"}];

  const PAIN_LEVELS=["ูุง ุฃูู","ุฎููู","ูุชูุณุท","ุดุฏูุฏ","ุดุฏูุฏ ุฌุฏูุง"];
  const EFFORT_LEVELS=["ุฎููู","ูุชูุณุท","ูุฑุชูุน"];

  // ===== App State =====
  let route='landing';
  let role=null; // 'patient' | 'specialist'
  let query='ุฑูุจุฉ';
  let results=[...SPECIALISTS];
  let selectedSP=null;
  let exercises=readLS('exercises', DEFAULT_EXERCISES);
  let appointments=readLS('appointments', []);
  let referrals=readLS('referrals', []);

  let sp_patients=readLS('sp_patients', DEFAULT_PATIENTS);
  let sp_plans=readLS('sp_plans', {});
  let sp_readings=readLS('sp_readings', {});
  // ูุณุชุฎุฏู ุฃูู ุฃุฎุตุงุฆู ููููุฉ ุงูุชุฑุงุถูุฉ ูุฑุจุท ุงูููุงุนูุฏ ููุท
  let sp_userId = readLS('sp_userId', SPECIALISTS[0]?.id || 'sp1');
  let sp_currentId=sp_patients[0]?.id || '';

  // ===== Helpers: ุชูุฏู ุงูุชูุงุฑูู + ุตูุญุฉ ุงููุฑูุถ ุงูุฑุฆูุณูุฉ =====
  function calculateProgress(){
    const total = exercises.length || 1;
    const done = exercises.filter(e=>e.done).length;
    const pct = Math.round((done/total)*100);
    return {total,done,pct};
  }

  function renderHome(){
    // ุดุฑูุท ุงูุชูุฏู
    const { pct } = calculateProgress();
    const pctSafe = isNaN(pct)?0:pct;
    const pctText = pctSafe + '%';
    const pctEl = document.getElementById('home-progressPct');
    const barEl = document.getElementById('home-progressBar');
    if(pctEl) pctEl.textContent = pctText;
    if(barEl) barEl.style.width = pctText;

    // ุงูุฌูุณุฉ ุงููุงุฏูุฉ
    const box = document.getElementById('home-next-appt');
    if(!box) return;
    box.innerHTML='';

    if(!appointments.length){
      box.innerHTML='<span class="muted text-sm">ูุง ุชูุฌุฏ ููุงุนูุฏ ููุฑูุฑุฉ ุญุงูููุง. ููููู ุญุฌุฒ ููุนุฏ ุฌุฏูุฏ ูู ุฒุฑ "ุญุฌุฒ ููุนุฏ ุฌุฏูุฏ / ุงูุนุซูุฑ ุนูู ุฃุฎุตุงุฆู".</span>';
      return;
    }
    const now = new Date();
    const sorted=[...appointments].sort(
      (a,b)=> new Date(a.date+' '+a.time) - new Date(b.date+' '+b.time)
    );
    const next = sorted.find(a=> new Date(a.date+' '+a.time) > now) || sorted[0];

    box.innerHTML=`
      <div class="card p-4" style="background:#f0f9ff;border-color:var(--sky-600);border-width:1px">
        <div class="fw-700">${next.specialist.name}</div>
        <div class="text-sm muted">
          ๐ ${next.date} โข ${next.time}
          โ ${next.specialist.remote ? 'ุฌูุณุฉ ุนู ุจูุนุฏ' : ('ูู ุงูุนูุงุฏุฉ / '+next.specialist.location)}
        </div>
        ${next.notes ? `<div class="text-xs muted" style="margin-top:4px">ููุงุญุธุงุชู: ${next.notes}</div>` : ''}
      </div>
    `;
  }

  // ===== Routing =====
  const pages={
    landing: $('#page-landing'),
    login: $('#page-login'),
    home: $('#page-home'),
    find: $('#page-find'),
    dashboard: $('#page-dashboard'),
    specialist: $('#page-specialist')
  };

  function setRoute(r){
    if(role==='patient' && r==='specialist') r='home';
    if(role==='specialist' && (r==='dashboard' || r==='find' || r==='home')) r='specialist';
    route=r;
    Object.values(pages).forEach(el=>el&&el.classList.add('hidden'));
    pages[r]?.classList.remove('hidden');

    const navBar = document.getElementById('navbar');
    const landingHeader = document.getElementById('landing-header');

    if(r==='landing'){
      landingHeader.classList.remove('hidden');
      navBar.classList.add('hidden');
    }else if(r==='login'){
      landingHeader.classList.add('hidden');
      navBar.classList.add('hidden');
    }else{
      landingHeader.classList.add('hidden');
      navBar.classList.remove('hidden');
    }

    updateNavbarForRole();
    $$('.nav-btn').forEach(b=>b.classList.toggle('active', b.dataset.route===r));
    if(r==='dashboard'){renderDashboard()}
    if(r==='find'){renderFind()}
    if(r==='home'){ $('#home-query').value=query; renderHome(); }
    if(r==='specialist'){
      renderSpecialist();
      renderSpAppointments();
      setSpTab('sp-tab-main');
    }
  }

  // ===== Navbar events =====
  function updateNavbarForRole(){
    $$('.nav-btn[data-role]').forEach(btn=>{
      const need = btn.dataset.role;
      btn.style.display = (!role || need===undefined) ? '' : (need===String(role) ? '' : 'none');
    });
  }
  $$('.nav-btn').forEach(b=> b.addEventListener('click',()=> setRoute(b.dataset.route)) );
  $('#logoutBtn').addEventListener('click',()=>{ role=null; updateNavbarForRole(); setRoute('landing') });

  // ===== Landing events =====
  const landingLoginTop = document.getElementById('landing-login-top');
  if(landingLoginTop){
    landingLoginTop.addEventListener('click', ()=> setRoute('login'));
  }

  const landingSearchBtn = document.getElementById('landing-search');
  if(landingSearchBtn){
    landingSearchBtn.addEventListener('click',()=>{
      const val = (document.getElementById('landing-query')?.value || '').trim();
      query = val || query;
      search();
      setRoute('find');
    });
  }
  const landingGoFind = document.getElementById('landing-go-find');
  if(landingGoFind){
    landingGoFind.addEventListener('click',()=> setRoute('find'));
  }

  // ===== Login =====
  let chosenRole=null;
  $('#role-patient').addEventListener('click',()=>{
    chosenRole='patient';
    $('#role-patient').classList.add('btn-primary');
    $('#role-specialist').classList.remove('btn-primary')
  });
  $('#role-specialist').addEventListener('click',()=>{
    chosenRole='specialist';
    $('#role-specialist').classList.add('btn-primary');
    $('#role-patient').classList.remove('btn-primary')
  });
  $('#login-submit').addEventListener('click',()=>{
    const email=$('#login-email').value.trim();
    const pass=$('#login-pass').value;
    if(!chosenRole || !email.includes('@') || pass.length<4){
      alert('ุชุญูู ูู ุงูููุน ูุงูุจุฑูุฏ ููููุฉ ุงููุฑูุฑ (ูค+).'); return;
    }
    role=chosenRole;
    setRoute(role==='patient'?'home':'specialist');
  });

  const loginBackBtn = document.getElementById('login-back');
  if(loginBackBtn){
    loginBackBtn.addEventListener('click', ()=> setRoute('landing'));
  }

  // ===== Home =====
  $('#home-search').addEventListener('click',()=>{
    query=$('#home-query').value;
    search();
    setRoute('find');
  });
  $('#home-go-find').addEventListener('click',()=> setRoute('find'));
  const homeGoDash = document.getElementById('home-go-dashboard');
  if(homeGoDash){
    homeGoDash.addEventListener('click',()=> setRoute('dashboard'));
  }

  // ===== Find =====
  $('#find-search').addEventListener('click',()=>{query=$('#find-query').value; search();});
  function search(){
    const q=(query||'').trim();
    if(!q){ results=[...SPECIALISTS]; renderFind(); return }
    const words=q.replace(/[ุ,ุ.]/g,' ').split(/\s+/).filter(Boolean);
    results=([...SPECIALISTS].map(sp=>({
      sp,
      score:words.reduce((a,w)=> a + (sp.tags.some(t=>t.includes(w))?1:0),0)
    }))
      .sort((a,b)=> b.score - a.score || b.sp.rating - a.sp.rating)
      .filter(x=> x.score>0 || words.length===0)
      .map(x=>x.sp));
    renderFind();
  }
  function renderFind(){
    $('#find-query').value=query;
    $('#find-hint').textContent = query?`ูุชุงุฆุฌ ูุทุงุจูุฉ ูู "${query}" โ ${results.length} ุฃุฎุตุงุฆู/ูุฉ ููุชุฑุญ/ูุฉ`:'';
    const box=$('#find-list'); box.innerHTML='';
    if(results.length===0){
      box.innerHTML = `<div class="center muted" style="padding:30px">ูุง ุชูุฌุฏ ูุชุงุฆุฌ ูุทุงุจูุฉ ุญุงูููุง โ ุฌุฑูุจ ูููุงุช ุฃุฎุฑู (ูุซุงู: ุฑูุจุฉุ ุฑูุจุฉุ ุธูุฑ).</div>`;
      return;
    }
    results.forEach(sp=>{
      const el=document.createElement('div'); el.className='card p-4';
      el.innerHTML=`
        <div class="flex items-center justify-between">
          <div>
            <div class="flex items-center gap-2">
              <b>${sp.name}</b>
              <span class="badge">${sp.location}</span>
              ${sp.remote?'<span class="badge">ุนู ุจูุนุฏ</span>':''}
            </div>
            <div class="text-sm muted" style="margin-top:2px">${sp.title}</div>
            <div class="text-xs muted" style="margin-top:6px">โญ ${sp.rating.toFixed(1)} (${sp.reviews} ุชูููู)</div>
            <div style="margin-top:8px">${sp.tags.map(t=>`<span class="badge">#${t}</span>`).join(' ')}</div>
            <div class="text-sm" style="margin-top:8px">๐ ${sp.location} โข <span style="color:var(--sky-600);font-weight:600">${sp.price} ุฑ.ุณ</span> / ุฌูุณุฉ</div>
          </div>
          <button class="btn btn-primary">ุญุฌุฒ ููุนุฏ</button>
        </div>`;
      el.querySelector('button').addEventListener('click',()=> openBooking(sp));
      box.appendChild(el);
    });
  }

  // ===== Booking / Share =====
  function openBooking(sp){
    selectedSP=sp;
    $('#bk-title').textContent=`ุญุฌุฒ ููุนุฏ ูุน ${sp.name}`;
    const sel=$('#bk-time');
    sel.innerHTML='<option value="">ุงุฎุชุฑ ููุชูุง</option>' + sp.slots.map(s=>`<option>${s}</option>`).join('');
    $('#bk-date').value='';
    $('#bk-notes').value='';
    $('#bk-confirm').disabled=true;
    showModal('booking');
  }
  $('#bk-date').addEventListener('input', enableConfirm);
  $('#bk-time').addEventListener('input', enableConfirm);
  function enableConfirm(){ $('#bk-confirm').disabled = !($('#bk-date').value && $('#bk-time').value) }

  $('#bk-confirm').addEventListener('click',()=>{
    const date=$('#bk-date').value;
    const time=$('#bk-time').value;
    const notes=$('#bk-notes').value.slice(0,180);
    const appt={specialist:selectedSP,date,time,notes};
    appointments=[...appointments, appt]; saveLS('appointments', appointments);
    hideModal('booking'); setRoute('dashboard');

    if(sp_userId && appt.specialist?.id===sp_userId){
      try{ renderSpAppointments(); }catch{}
    }

    const ref={
      id:uid(),
      createdAt:new Date().toISOString(),
      specialist:{id:selectedSP.id,name:selectedSP.name,email:selectedSP.email,phone:selectedSP.phone},
      patient:{name:'ูุณุชุฎุฏู PhysioConnect'},
      date,time,
      symptoms:query,
      notes:($('#bk-notes').value||'').slice(0,500),
      ratings: readLS('exercises', DEFAULT_EXERCISES).map(e=>({id:e.id,name:e.name,pain:e.pain??null,effort:e.effort??null,done:e.done}))
    };
    referrals=[ref,...referrals]; saveLS('referrals', referrals); openShare(ref);
  });
  $$('#booking [data-close]').forEach(b=> b.addEventListener('click',()=> hideModal('booking')) );

  function openShare(payload){
  $('#sh-sp').textContent = payload.specialist.name;
  $('#sh-dt').textContent = `${payload.date} โ ${payload.time}`;
  $('#sh-sym').textContent = payload.symptoms || 'โ';
  $('#sh-notes').textContent = payload.notes || 'โ';
  $('#sh-id').textContent = payload.id;
  $('#sh-json').value = JSON.stringify(payload, null, 2);

  // ุฅุฑุณุงู ุนุจุฑ ุงูุฅูููู (ููุณ ูุง ูู)
  const mail=`mailto:${encodeURIComponent(payload.specialist.email)}?subject=${encodeURIComponent('ุฅุญุงูุฉ/ุทูุจ ููุนุฏ โ PhysioConnect')}&body=${encodeURIComponent(
`ุจูุงูุงุช ุงูุญุฌุฒ:
- ุงููุฑูุถ: ${payload.patient.name}
- ุงูุชุงุฑูุฎ: ${payload.date}
- ุงูููุช: ${payload.time}
- ุงูุฃุนุฑุงุถ: ${payload.symptoms||'โ'}
- ููุงุญุธุงุช: ${payload.notes||'โ'}
- ุฑูุฒ ุงูุฅุญุงูุฉ: ${payload.id}`)}`;

  // ๐ ููุง ุงูุชุบููุฑ: ุชุฌุงูู ุฑูู ุงูุฃุฎุตุงุฆู ูุงุณุชุฎุฏู ุฑูู ุซุงุจุช
  const waNumber = '966505914101'; // 0505914101 ุจุตูุบุฉ ุฏูููุฉ ุจุฏูู ุงูุตูุฑ

  const wa=`https://wa.me/${waNumber}?text=${encodeURIComponent(
`ูุฑุญุจูุงุ ูุฐุง ุทูุจ ููุนุฏ ุฌุฏูุฏ ุนุจุฑ PhysioConnect
ุงูุฃุฎุตุงุฆู: ${payload.specialist.name}
ุงูุชุงุฑูุฎ: ${payload.date} ${payload.time}
ุงูุฃุนุฑุงุถ: ${payload.symptoms||'โ'}
ุงูููุงุญุธุงุช: ${payload.notes||'โ'}
ุฑูุฒ ุงูุฅุญุงูุฉ: ${payload.id}`)}`;

  $('#sh-mail').setAttribute('href', mail);
  $('#sh-wa').setAttribute('href', wa);
  showModal('share');
}

  $('#sh-copy').addEventListener('click', async()=>{
    const ok=await copyText($('#sh-json').value);
    alert(ok?'ุชู ุงููุณุฎ โ':'ุชุนุฐูุฑ ุงููุณุฎ');
  });
  $('#sh-dl').addEventListener('click',()=> downloadJSON(JSON.parse($('#sh-json').value), `physio-referral-${$('#sh-id').textContent}.json`) );
  $$('#share [data-close]').forEach(b=> b.addEventListener('click',()=> hideModal('share')) );

  function showModal(id){
    const el=$('#'+id); if(!el) return;
    el.classList.remove('hidden'); el.setAttribute('aria-hidden','false');
  }
  function hideModal(id){
    const el=$('#'+id); if(!el) return;
    el.classList.add('hidden'); el.setAttribute('aria-hidden','true');
  }

  // ===== Dashboard (patient) =====
  function renderDashboard(){
    const box=$('#appt-list'); box.innerHTML='';
    if(appointments.length===0){
      box.innerHTML='<div class="muted">ูุง ุชูุฌุฏ ููุงุนูุฏ ุจุนุฏ. ุงุญุฌุฒ ุฃูู ููุนุฏ ูู ุตูุญุฉ ุงูุจุญุซ.</div>';
    }
    appointments.forEach((a,i)=>{
      const el=document.createElement('div'); el.className='card p-4';
      el.innerHTML=`<div class="flex items-center justify-between">
        <div>
          <div class="fw-700">${a.specialist.name}</div>
          <div class="text-sm muted">๐ ${a.date} โข ${a.time} โ ${a.specialist.remote? 'ุฌูุณุฉ ุนู ุจูุนุฏ': a.specialist.location}</div>
          ${a.notes?`<div class="text-xs muted">ููุงุญุธุงุช: ${a.notes}</div>`:''}
        </div>
        <div class="flex gap-2">
          <button class="btn">ุงุชุตุงู</button>
          <button class="btn btn-primary">ุฏุฎูู ุงูุฌูุณุฉ</button>
          <button class="btn" data-share>ุญูุธ ููุดุงุฑูุฉ</button>
          <button class="btn" data-cancel>ุฅูุบุงุก</button>
        </div>
      `;
      el.querySelector('[data-share]').addEventListener('click',()=>{
        const exs=readLS('exercises', DEFAULT_EXERCISES);
        const ref={
          id:uid(),
          createdAt:new Date().toISOString(),
          specialist:{id:a.specialist.id,name:a.specialist.name,email:a.specialist.email,phone:a.specialist.phone},
          patient:{name:'ูุณุชุฎุฏู PhysioConnect'},
          date:a.date,time:a.time,
          symptoms:query,
          notes:a.notes||'',
          ratings: exs.map(e=>({id:e.id,name:e.name,pain:e.pain??null,effort:e.effort??null,done:e.done}))
        };
        referrals=[ref,...referrals]; saveLS('referrals',referrals); openShare(ref);
      });
      el.querySelector('[data-cancel]').addEventListener('click',()=>{
        appointments=appointments.filter((_,j)=>j!==i);
        saveLS('appointments',appointments);
        renderDashboard();
        try{ renderSpAppointments(); }catch{}
      });
      box.appendChild(el);
    });

    const exBox=$('#ex-list'); exBox.innerHTML='';
    const completed=exercises.filter(e=>e.done).length;
    const progress=Math.round( (completed/Math.max(exercises.length,1))*100 );
    $('#progressPct').textContent=progress+"%";
    $('#progressBar').style.width=progress+"%";
    exercises.forEach(ex=>{
      const el=document.createElement('div'); el.className='card p-4';
      el.innerHTML=`
        <label class="flex items-center gap-3">
          <input type="checkbox" ${ex.done?'checked':''}/>
          <span class="${ex.done?'line-through muted':''}">${ex.name}</span>
        </label>
        <div class="flex gap-2" style="margin-top:8px"><button class="btn" data-details>ุดุฑุญ ุงูุชูุฑูู</button></div>
        <div class="row row-2" style="margin-top:8px">
          <div>
            <div class="text-xs muted" style="margin-bottom:4px">ูุณุชูู ุงูุฃูู (ูููุงุช):</div>
            <div class="flex gap-2">
              ${PAIN_LEVELS.map(p=>`<button class="btn ${ex.pain===p?'btn-rose':''}" data-pain="${p}">${p}</button>`).join('')}
            </div>
            ${ex.pain?`<div class="text-xs" style="margin-top:4px">ุงููุญุฏุฏ: <b>${ex.pain}</b></div>`:''}
          </div>
          <div>
            <div class="text-xs muted" style="margin-bottom:4px">ูุณุชูู ุงูุฌูุฏ (ูููุงุช):</div>
            <div class="flex gap-2">
              ${EFFORT_LEVELS.map(e=>`<button class="btn ${ex.effort===e?'btn-emerald':''}" data-effort="${e}">${e}</button>`).join('')}
            </div>
            ${ex.effort?`<div class="text-xs" style="margin-top:4px">ุงููุญุฏุฏ: <b>${ex.effort}</b></div>`:''}
          </div>
        </div>`;
      el.querySelector('input').addEventListener('change',(ev)=>{
        ex.done=ev.target.checked; saveLS('exercises',exercises); renderDashboard()
      });
      el.querySelector('[data-details]').addEventListener('click',()=>{
        alert(`${ex.name}\n\n${ex.desc||''}\n\nุงูุฎุทูุงุช:\n- ${(ex.steps||[]).join('\n- ')}\n\nุชูุจููุงุช:\n- ${(ex.cautions||[]).join('\n- ')}`);
      });
      el.querySelectorAll('[data-pain]').forEach(b=> b.addEventListener('click',()=>{
        ex.pain=b.dataset.pain; saveLS('exercises',exercises); renderDashboard();
      }));
      el.querySelectorAll('[data-effort]').forEach(b=> b.addEventListener('click',()=>{
        ex.effort=b.dataset.effort; saveLS('exercises',exercises); renderDashboard();
      }));
      exBox.appendChild(el);
    });
  }

  // ===== Specialist (patients, plans, chart) =====
  function renderSpecialist(){
    const list=$('#sp-patients'); list.innerHTML='';
    sp_patients.forEach(p=>{
      const el=document.createElement('div'); el.className='flex items-center justify-between card p-4';
      el.innerHTML=`<button class="btn" data-open>${p.name}</button><button class="btn" data-del>ุญุฐู</button>`;
      el.querySelector('[data-open]').addEventListener('click',()=>{ sp_currentId=p.id; renderSpecialist() });
      el.querySelector('[data-del]').addEventListener('click',()=>{
        sp_patients=sp_patients.filter(x=>x.id!==p.id); delete sp_plans[p.id]; delete sp_readings[p.id];
        saveLS('sp_patients',sp_patients); saveLS('sp_plans',sp_plans); saveLS('sp_readings',sp_readings);
        if(sp_currentId===p.id) sp_currentId=sp_patients[0]?.id||'';
        renderSpecialist();
      });
      list.appendChild(el);
    });
    if(sp_patients.length===0){
      list.innerHTML='<div class="muted text-sm">ูุง ููุฌุฏ ูุฑุถู โ ุฃุถู ูุฑูุถูุง ุฌุฏูุฏูุง.</div>';
    }
    $('#sp-current-name').textContent = (sp_patients.find(p=>p.id===sp_currentId)||{}).name || 'โ';

    const planBox=$('#sp-plan'); planBox.innerHTML='';
    const plan = sp_plans[sp_currentId] || [];
    plan.forEach(e=>{
      const el=document.createElement('div'); el.className='flex items-center justify-between card p-4';
      el.innerHTML=`<div>
        <div class="fw-700">${e.name}</div>
        <div class="text-xs muted">${e.notes||'โ'}</div>
        ${e.video?`<div class="text-xs"><a href="${e.video}" target="_blank">ุฑุงุจุท ููุฏูู</a></div>`:''}
      </div><button class="btn" data-del>ุญุฐู</button>`;
      el.querySelector('[data-del]').addEventListener('click',()=>{
        sp_plans[sp_currentId] = (sp_plans[sp_currentId]||[]).filter(x=>x.id!==e.id);
        saveLS('sp_plans',sp_plans);
        renderSpecialist();
      });
      planBox.appendChild(el);
    });
    if(plan.length===0){
      planBox.innerHTML='<div class="muted text-sm">ูุง ุชูุฌุฏ ุชูุงุฑูู ุจุนุฏ.</div>';
    }

    drawChart();
  }

  $('#sp-add').addEventListener('click',()=>{
    const name=$('#sp-new-name').value.trim();
    if(!name) return;
    const p={id:uid(),name};
    sp_patients=[p,...sp_patients];
    saveLS('sp_patients',sp_patients);
    $('#sp-new-name').value='';
    sp_currentId=p.id;
    renderSpecialist();
  });

  $('#sp-add-ex').addEventListener('click',()=>{
    if(!sp_currentId) return;
    const name=$('#ex-name').value.trim();
    if(!name) return;
    const ex={
      id:uid(),
      name: `${name}${Number($('#ex-sets').value)?` (${Number($('#ex-sets').value)}ร${Number($('#ex-reps').value)})`:''}`,
      reps:Number($('#ex-reps').value)||10,
      sets:Number($('#ex-sets').value)||3,
      holdSec:Number($('#ex-hold').value)||0,
      video:($('#ex-video').value||'').trim()||undefined,
      notes:($('#ex-notes').value||'').trim()||undefined
    };
    sp_plans[sp_currentId]=[ex, ...(sp_plans[sp_currentId]||[])];
    saveLS('sp_plans',sp_plans);
    $('#ex-name').value=''; $('#ex-video').value=''; $('#ex-notes').value='';
    $('#ex-hold').value=0; $('#ex-reps').value=12; $('#ex-sets').value=3;
    renderSpecialist();
  });
  $('#sp-new-plan').addEventListener('click',()=>{
    if(!sp_currentId) return;
    sp_plans[sp_currentId]=[];
    saveLS('sp_plans',sp_plans);
    renderSpecialist();
  });

  $('#sp-add-reading').addEventListener('click',()=>{
    if(!sp_currentId) return;
    const day=new Date();
    const label=day.toISOString().slice(0,10);
    const rnd=(a,b)=> Math.max(0,Math.min(10, Math.round(a+Math.random()*(b-a))));
    const rec={date:label,pain:rnd(2,6),rpe:rnd(2,6)};
    const list=sp_readings[sp_currentId]||[];
    sp_readings[sp_currentId]=[...list.slice(-13),rec];
    saveLS('sp_readings',sp_readings);
    drawChart();
  });

  function drawChart(){
    const svg=$('#sp-chart'); const width=560, height=220, pad=28, maxY=10;
    const base=[
      {date:'ุงูููู 1',pain:6,rpe:5},
      {date:'ุงูููู 2',pain:5,rpe:6},
      {date:'ุงูููู 3',pain:4,rpe:5},
      {date:'ุงูููู 4',pain:5,rpe:4},
      {date:'ุงูููู 5',pain:3,rpe:3},
      {date:'ุงูููู 6',pain:2,rpe:4},
      {date:'ุงูููู 7',pain:3,rpe:3}
    ];
    const rs=(sp_readings[sp_currentId]||[]).length? sp_readings[sp_currentId]: base;
    const labels=rs.map(r=> r.date.replace(/^\d{4}-/,'') );
    const pain=rs.map(r=>r.pain);
    const rpe=rs.map(r=>r.rpe);
    const x=i => pad + (i*(width-pad*2))/Math.max(labels.length-1,1);
    const y=v => pad + (height-pad*2) * (1 - v/maxY);
    const path = arr => arr.map((v,i)=> `${i===0?'M':'L'}${x(i)},${y(v)}`).join(' ');
    svg.innerHTML='';
    [0,2,4,6,8,10].forEach(g=>{
      const l=document.createElementNS('http://www.w3.org/2000/svg','line');
      l.setAttribute('x1',pad); l.setAttribute('x2',width-pad);
      l.setAttribute('y1',y(g)); l.setAttribute('y2',y(g));
      l.setAttribute('stroke','#e5e7eb'); l.setAttribute('stroke-dasharray','4 4'); svg.appendChild(l);
      const t=document.createElementNS('http://www.w3.org/2000/svg','text');
      t.setAttribute('x',8); t.setAttribute('y',y(g)+4);
      t.setAttribute('font-size','10'); t.setAttribute('fill','#64748b');
      t.textContent=g; svg.appendChild(t);
    });
    const p=document.createElementNS('http://www.w3.org/2000/svg','path');
    p.setAttribute('d', path(pain)); p.setAttribute('fill','none');
    p.setAttribute('stroke', '#ef4444'); p.setAttribute('stroke-width','2'); svg.appendChild(p);
    const r=document.createElementNS('http://www.w3.org/2000/svg','path');
    r.setAttribute('d', path(rpe)); r.setAttribute('fill','none');
    r.setAttribute('stroke', '#0ea5e9'); r.setAttribute('stroke-width','2'); svg.appendChild(r);
    labels.forEach((lb,i)=>{
      const t=document.createElementNS('http://www.w3.org/2000/svg','text');
      t.setAttribute('x', x(i)); t.setAttribute('y', height-6);
      t.setAttribute('font-size','10'); t.setAttribute('text-anchor','middle');
      t.setAttribute('fill','#94a3b8'); t.textContent=lb; svg.appendChild(t);
    });
  }

  // ===== Specialist Appointments Tab =====
  function renderSpAppointments(){
    const box = document.getElementById('sp-appointments');
    if(!box) return;
    const q = (document.getElementById('sp-appt-q')?.value || '').trim().toLowerCase();
    box.innerHTML = '';

    const mine = appointments.filter(a=> a.specialist && a.specialist.id === sp_userId);
    let filtered = mine;
    if(q){
      filtered = mine.filter(a=>{
        return (a.specialist.name || '').toLowerCase().includes(q) ||
               (a.notes || '').toLowerCase().includes(q) ||
               (a.date || '').toLowerCase().includes(q) ||
               (a.time || '').toLowerCase().includes(q);
      });
    }

    if(filtered.length===0){
      box.innerHTML = '<div class="muted text-sm">ูุง ุชูุฌุฏ ููุงุนูุฏ ูุฑุชุจุทุฉ ุจูุฐุง ุงูุฃุฎุตุงุฆู ุญุงูููุง.</div>';
      return;
    }

    filtered.forEach((a)=>{
      const el=document.createElement('div'); el.className='card p-4';
      el.innerHTML=`
        <div class="flex items-center justify-between">
          <div>
            <div class="fw-700">${a.specialist.name}</div>
            <div class="text-sm muted">๐ ${a.date} โข ${a.time} โ ${a.specialist.remote? 'ุฌูุณุฉ ุนู ุจูุนุฏ': a.specialist.location}</div>
            ${a.notes?`<div class="text-xs muted">ููุงุญุธุงุช ุงููุฑูุถ: ${a.notes}</div>`:''}
          </div>
          <div class="flex gap-2">
            <button class="btn" data-share>ูุดุงุฑูุฉ</button>
            <button class="btn" data-cancel>ุฅูุบุงุก ุงูููุนุฏ</button>
          </div>
        </div>`;
      el.querySelector('[data-share]').addEventListener('click',()=>{
        const exs=readLS('exercises', DEFAULT_EXERCISES);
        const ref={
          id:uid(),
          createdAt:new Date().toISOString(),
          specialist:{id:a.specialist.id,name:a.specialist.name,email:a.specialist.email,phone:a.specialist.phone},
          patient:{name:'ูุณุชุฎุฏู PhysioConnect'},
          date:a.date,time:a.time,
          symptoms:query,
          notes:a.notes||'',
          ratings: exs.map(e=>({id:e.id,name:e.name,pain:e.pain??null,effort:e.effort??null,done:e.done}))
        };
        referrals=[ref,...referrals]; saveLS('referrals',referrals); openShare(ref);
      });
      el.querySelector('[data-cancel]').addEventListener('click',()=>{
        appointments = appointments.filter(a2 => !(a2.date===a.date && a2.time===a.time && a2.specialist.id===a.specialist.id && a2.notes===a.notes));
        saveLS('appointments', appointments);
        renderSpAppointments();
        try{ renderDashboard(); }catch{}
      });
      box.appendChild(el);
    });
  }

  // ===== Specialist Tabs =====
  function setSpTab(tabId){
    const ids = ['sp-tab-main','sp-tab-appts','sp-tab-ai'];
    ids.forEach(id=>{
      const sec = document.getElementById(id);
      if(!sec) return;
      if(id===tabId) sec.classList.remove('hidden');
      else sec.classList.add('hidden');
    });
    $$('.sp-tab-btn').forEach(btn=>{
      btn.classList.toggle('btn-primary', btn.dataset.tab===tabId);
    });
  }

  // ===== Shared AI logic =====
  function buildAiResponseHtml(txt){
    const blocks=[];
    if(/ุฑูุจุฉ|ุฑุจุงุท|ุบุถุฑูู/.test(txt)){
      blocks.push(
        'โข ุงูุชุฑููุฒ ุนูู ุชูุงุฑูู ุชูููุฉ ุงูุนุถูุฉ ุงูุฑุจุงุนูุฉ ูุงููุฑูุ ูุน ุชุฌููุจ ุงูุฌุฑู ุฃู ุงูููุฒ ูู ุงููุฑุงุญู ุงูุฃููู.',
        'โข ูููู ุงูุชุฑุงุญ ุชูุงุฑูู ูุซู: Straight Leg Raiseุ Mini Squatsุ ูBridging ุจุฏุฑุฌุงุช ุชูุฏู ูุฎุชููุฉ.'
      );
    }
    if(/ุธูุฑ|ุงุณูู ุงูุธูุฑ|ุฃุณูู ุงูุธูุฑ|ุนููุฏ/.test(txt)){
      blocks.push(
        'โข ุงูุจุฏุก ุจุชูุงุฑูู ุงูุชุญูู ูู ุงูุฌุฐุน (Core Stability) ูุน ุชุตุญูุญ ูุถุนูุงุช ุงูุฌููุณ ููุชุฑุงุช ุงูุนูู ุฃู ุงูุฏุฑุงุณุฉ.',
        'โข ุชูุงุฑูู ููุชุฑุญุฉ: Pelvic Tiltุ CatโCamelุ Plank ุงููุนุฏูุ ูุน ุฒูุงุฏุฉ ุงูุดุฏุฉ ุชุฏุฑูุฌููุง ุญุณุจ ุชุญููู ุงููุฑูุถ.'
      );
    }
    if(/ุฑูุจุฉ|ุนูู|ูุชู/.test(txt)){
      blocks.push(
        'โข ุงูุชุฑููุฒ ุนูู ุชูุงุฑูู ุงูุฅุทุงูุฉ ุงููุทููุฉ ููุฑูุจุฉุ ูุชูููุฉ ุนุถูุงุช ุงููุชู ุงูุนููุง ูุงููุชูุณุทุฉ ูุน ูุฑุงุฌุนุฉ ูุถุนูุฉ ุงูุฑุฃุณ ููุฃูุงู.',
        'โข ูููู ุงูุชุฏุฑุฌ ูู ุงูุชูุงุฑูู ูู ุฅุทุงูุงุช ุจุณูุทุฉ ุฅูู ุชูููุฉ ุจุงุณุชุฎุฏุงู ุฃุดุฑุทุฉ ูุทุงุทูุฉ (TheraBand).'
      );
    }
    if(/ุจุนุฏ ุงูุนูููุฉ|ุนูููุฉ|ุฌุฑุงุญุฉ/.test(txt)){
      blocks.push(
        'โข ุงูุชุฃููุฏ ุนูู ุงูุงูุชุฒุงู ุจุชุนูููุงุช ุงูุฌุฑุงุญ ููุฑูู ุงูุชุฃููู ูู ุญูุซ ุนุฏุฏ ุงูุชูุฑุงุฑุงุช ูุญุฏูุฏ ุงูุญุฑูุฉ ุงููุณููุญ ุจูุง.',
        'โข ูุชู ุชุนุฏูู ุดุฏุฉ ุงูุชูุงุฑูู ุทุจููุง ููุฑุญูุฉ ูุง ุจุนุฏ ุงูุนูููุฉ (ูุฑุญูุฉ ุญูุงูุฉุ ุงุณุชุนุงุฏุฉ ุญุฑูุฉุ ุชูููุฉ ูุชูุฏูุฉ).'
      );
    }
    if(blocks.length===0){
      blocks.push(
        'โข ูููุตุญ ุจุจุฏุก ุจุฑูุงูุฌ ุชูุงุฑูู ุชุฏุฑูุฌู ูุฑุงุนู ุดุฏุฉ ุงูุฃูู ูุงูุญุงูุฉ ุงูุตุญูุฉ ุงูุนุงูุฉ.',
        'โข ููุถูู ุชุณุฌูู ูุณุชูู ุงูุฃูู ูุจู ูุจุนุฏ ุงูุชูุฑููุ ููุฑุงุฌุนุฉ ุงูุฎุทุฉ ุงูุนูุงุฌูุฉ ุนูุฏ ุฒูุงุฏุฉ ุงูุฃุนุฑุงุถ ุฃู ุนุฏู ุชุญุณููุง.'
      );
    }

    return `
      <div class="text-sm">
        <div style="margin-bottom:6px"><b>ุชุญููู ูุจุฏุฆู ูููุต ุงููุฏุฎู:</b></div>
        <ul style="margin:0;padding-right:20px">
          ${blocks.map(b=>`<li>${b}</li>`).join('')}
        </ul>
        <div class="text-xs muted" style="margin-top:8px">
          ูุฐู ุงูุชูุตูุงุช ูุฃุบุฑุงุถ ุชุนููููุฉ ููุทุ ูุงูุฎุทุฉ ุงูููุงุฆูุฉ ูุฌุจ ุฃู ุชุนุชูุฏ ุนูู ุชูููู ุฃุฎุตุงุฆู ุงูุนูุงุฌ ุงูุทุจูุนู.
        </div>
      </div>`;
  }

  function runAiAssistantFor(inputId, outputId){
    const inputEl = document.getElementById(inputId);
    const outEl = document.getElementById(outputId);
    if(!inputEl || !outEl) return;
    const txt = inputEl.value.trim();
    if(!txt){
      outEl.innerHTML = '<span class="muted">ุงูุฑุฌุงุก ูุชุงุจุฉ ูุตู ูุฎุชุตุฑ ููุญุงูุฉ ุฃู ุงูุณุคุงู ูุชุญููููุง ูุจุฏุฆููุง.</span>';
      return;
    }
    outEl.innerHTML = buildAiResponseHtml(txt);
  }

  // ===== Start =====
  document.getElementById('year').textContent = new Date().getFullYear();
  updateNavbarForRole();
  hideModal('share'); hideModal('booking');
  ['share','booking'].forEach(id=>{
    const m=document.getElementById(id);
    if(m){ m.classList.add('hidden'); m.setAttribute('aria-hidden','true'); }
  });
  setRoute('landing');

  // ุชุจููุจุงุช ุงูุฃุฎุตุงุฆู
  $$('.sp-tab-btn').forEach(btn=>{
    btn.addEventListener('click',()=> setSpTab(btn.dataset.tab));
  });
  const spApptQ = document.getElementById('sp-appt-q');
  if(spApptQ){
    spApptQ.addEventListener('input', renderSpAppointments);
  }

  // ุฃุฒุฑุงุฑ ุงููุณุงุนุฏ ุงูุฐูู
  const aiRunBtn = document.getElementById('ai-run');
  if(aiRunBtn){
    aiRunBtn.addEventListener('click', ()=> runAiAssistantFor('ai-input','ai-output'));
  }
  const ptAiBtn = document.getElementById('pt-ai-run');
  if(ptAiBtn){
    ptAiBtn.addEventListener('click', ()=> runAiAssistantFor('pt-ai-input','pt-ai-output'));
  }

  // ===== Runtime Tests =====
  console.assert(Array.isArray(SPECIALISTS)&&SPECIALISTS.length>=3,'[TEST] SPECIALISTS defined with >=3');
  console.assert(Array.isArray(DEFAULT_EXERCISES)&&DEFAULT_EXERCISES.length>=3,'[TEST] default exercises exist');
  console.assert(!!document.getElementById('page-login') && !!document.getElementById('page-dashboard') && !!document.getElementById('page-specialist'),'[TEST] pages exist');
  console.assert(true,'[TEST] app should start at landing');
  (function(){
    const prevRole = role, prevRoute = route;
    role='patient'; setRoute('specialist'); console.assert(route!=='specialist','[TEST] patient cannot open specialist');
    role='specialist'; setRoute('home'); console.assert(route==='specialist','[TEST] specialist locked to specialist page');
    role=prevRole; setRoute(prevRoute||'landing');
    const id1=uid(), id2=uid(); console.assert(id1!==id2 && id1.length>6 && id2.length>6,'[TEST] uid uniqueness');
  })();
  </script>
</body>
</html>
